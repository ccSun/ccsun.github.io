<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android-Fragment | 叶枫很疯</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android-Fragment</h1><a id="logo" href="/.">叶枫很疯</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android-Fragment</h1><div class="post-meta">Nov 11, 2015<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2015/11/11/android-fragment/" href="/2015/11/11/android-fragment/#comments" class="ds-thread-count"></a><div class="post-content"><p>收录于Fragment相关的内容，如生命周期，如何添加到activity，fragment通讯等。</p>
<h2 id="一、-Fragmentst-Lifecycle"><a href="#一、-Fragmentst-Lifecycle" class="headerlink" title="一、 Fragmentst Lifecycle"></a>一、 Fragmentst Lifecycle</h2><ol>
<li>A fragment must always be embedded in an activity and the fragment’s lifecycle is directly affected by the host activity’s lifecycle. For example, when the activity is paused, so are all fragments in it, and when the activity is destroyed, so are all fragments. </li>
<li>You can also <strong><em>add it to a back stack</em></strong>. The back stack allows the user to reverse a fragment transaction (navigate backwards), by pressing the Back button.</li>
<li><strong><em>onCreate()</em></strong> : initialize essential components of the fragment that you want to retain when the fragment is paused or stopped, then resumed.除了view之外的做初始化。</li>
<li><strong><em>onCreateView()</em></strong> : return a View from this method that is the root of your fragment’s layout.</li>
<li>You can <strong><em>save the state during the fragment’s onSaveInstanceState()</em></strong> callback and <strong><em>restore it during either onCreate(), onCreateView(), or onActivityCreated()</em></strong>.</li>
<li>只有Activity resume之后，才能操作fragment，否则fragment生命周期跟随anctivity不能操作，如在onPause，onStop等。</li>
<li>setretaininstance(true)，横竖屏切换的时候fragment不会被销毁，数据都会被保存下来。这样其中的imgView、editText等内存状态都还在内存。</li>
</ol>
<p><img src="https://github.com/ccSun/hexoBlogOnGitHub/blob/master/source/_posts/android-fragment/fragment_lifecycle.png?raw=true" alt="Fragmentst Lifecycle">   </p>
<h2 id="二、-subclasses"><a href="#二、-subclasses" class="headerlink" title="二、 subclasses:"></a>二、 subclasses:</h2><ul>
<li>DialogFragment</li>
<li>ListFragment</li>
<li>PreferenceFragment</li>
</ul>
<h2 id="三、Adding-a-fragment-to-an-activity"><a href="#三、Adding-a-fragment-to-an-activity" class="headerlink" title="三、Adding a fragment to an activity"></a>三、Adding a fragment to an activity</h2><h3 id="1-Declare-the-fragment-inside-the-activity’s-layout-file"><a href="#1-Declare-the-fragment-inside-the-activity’s-layout-file" class="headerlink" title="1. Declare the fragment inside the activity’s layout file."></a>1. Declare the fragment inside the activity’s layout file.</h3><p>When you add a fragment to an activity layout by defining the fragment in the layout XML file, you cannot remove the fragment at runtime. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span><br><span class="line"><span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line"><span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:name</span>=<span class="string">"com.example.news.ArticleReaderFragment"</span></span><br><span class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/viewer"</span></span><br><span class="line">    <span class="attr">android:layout_weight</span>=<span class="string">"2"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Each fragment requires a unique identifier that the system can use to restore the fragment if the activity is restarted (and which you can use to capture the fragment to perform transactions, such as remove it). There are <strong><em>three ways to provide an ID for a fragment</em></strong>:</p>
<ul>
<li>Supply the android:id attribute with a unique ID.</li>
<li>Supply the android:tag attribute with a unique string.</li>
<li>If you provide neither of the previous two, the system uses the ID of the container view.</li>
</ul>
<h3 id="2-programmatically-add-the-fragment-to-an-existing-ViewGroup"><a href="#2-programmatically-add-the-fragment-to-an-existing-ViewGroup" class="headerlink" title="2. programmatically add the fragment to an existing ViewGroup."></a>2. programmatically add the fragment to an existing ViewGroup.</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FragmentManager <span class="keyword">fragment</span>Manager = getFragmentManager();</span><br><span class="line">FragmentTransaction <span class="keyword">fragment</span>Transaction = <span class="keyword">fragment</span>Manager.beginTransaction();</span><br><span class="line">ExampleFragment <span class="keyword">fragment</span> = new ExampleFragment();</span><br><span class="line"><span class="keyword">fragment</span>Transaction.add(R.id.fragment_container, <span class="keyword">fragment</span>);</span><br><span class="line"><span class="keyword">fragment</span>Transaction.commit();</span><br></pre></td></tr></table></figure>
<h3 id="3、Adding-a-fragment-without-a-UI"><a href="#3、Adding-a-fragment-without-a-UI" class="headerlink" title="3、Adding a fragment without a UI"></a>3、Adding a fragment without a UI</h3><ol>
<li>you can also use a fragment to <strong><em>provide a background behavior for the activity without presenting additional UI</em></strong>.</li>
<li>To add a fragment without a UI, add the fragment from the activity using <strong><em>add(Fragment, String) (supplying a unique string “tag” for the fragment, rather than a view ID)</em></strong>. This adds the fragment, but, because it’s not associated with a view in the activity layout, <strong><em>it does not receive a call to onCreateView(). So you don’t need to implement that method</em></strong>.</li>
<li>If you want to get the fragment from the activity later, you need to use <strong><em>findFragmentByTag()</em></strong>.</li>
</ol>
<h2 id="四、-Performing-Fragment-Transactions"><a href="#四、-Performing-Fragment-Transactions" class="headerlink" title="四、 Performing Fragment Transactions"></a>四、 Performing Fragment Transactions</h2><ol>
<li>using methods such as add(), remove(), and replace(). Then, to apply the transaction to the activity, <strong><em>you must call commit()</em></strong>.</li>
<li><p>you might want to call <strong><em>addToBackStack()</em></strong>, in order to add the transaction to a back stack of fragment transactions. <strong><em>This back stack is managed by the activity and allows the user to return to the previous fragment state, by pressing the Back button</em></strong>. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// <span class="keyword">Replace</span> whatever <span class="keyword">is</span> <span class="keyword">in</span> the fragment_container <span class="keyword">view</span> <span class="keyword">with</span> this fragment,</span><br><span class="line">// <span class="keyword">and</span> <span class="keyword">add</span> the <span class="keyword">transaction</span> <span class="keyword">to</span> the back stack</span><br><span class="line"><span class="keyword">transaction</span>.<span class="keyword">replace</span>(R.<span class="keyword">id</span>.fragment_container, newFragment);</span><br><span class="line">transaction.addToBackStack(null);</span><br></pre></td></tr></table></figure>
</li>
<li><p>If you <strong><em>add multiple changes to the transaction</em></strong> (such as another add() or remove()) and call addToBackStack(), <strong><em>then all changes applied before you call commit() are added to the back stack as a single transaction and the Back button will reverse them all together</em></strong>.</p>
</li>
<li>If you <strong><em>do not call addToBackStack() when you perform a transaction that removes a fragment, then that fragment is destroyed</em></strong> when the transaction is committed and the user cannot navigate back to it.</li>
<li>For each fragment transaction, <strong><em>you can apply a transition animation, by calling setTransition() before you commit</em></strong>.<br><strong><em>Caution:</em></strong> You can commit a transaction <strong><em>using commit() only prior to the activity saving its state</em></strong> (when the user leaves the activity). If you attempt to commit after that point, an exception will be thrown. This is because the state after the commit can be lost if the activity needs to be restored. <strong><em>For situations in which its okay that you lose the commit, use commitAllowingStateLoss()</em></strong>.</li>
</ol>
<h2 id="五、-Communicating-with-Other-Fragments"><a href="#五、-Communicating-with-Other-Fragments" class="headerlink" title="五、 Communicating with Other Fragments"></a>五、 Communicating with Other Fragments</h2><ol>
<li>the fragment can access the Activity instance with <strong><em>getActivity()</em></strong>；</li>
<li>your activity can call methods in the fragment by acquiring a reference to the Fragment from FragmentManager, using <strong><em>findFragmentById() or findFragmentByTag()</em></strong>.<br><strong>All Fragment-to-Fragment communication is done through the associated Activity. Two Fragments should never communicate directly.</strong></li>
<li>define an interface in the Fragment class and implement it within the Activity. The Fragment captures the interface implementation during its onAttach() lifecycle method. Then the fragment can deliver messages to the activity by calling the onArticleSelected() method</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadlinesFragment</span> <span class="keyword">extends</span> <span class="title">ListFragment</span> </span>&#123;</span><br><span class="line">   	OnHeadlineSelectedListener mCallback;</span><br><span class="line"></span><br><span class="line">   	<span class="comment">// Container Activity must implement this interface</span></span><br><span class="line">   	<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnHeadlineSelectedListener</span> </span>&#123;</span><br><span class="line">       	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">   	&#125;</span><br><span class="line"></span><br><span class="line">   	<span class="meta">@Override</span></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">       	<span class="keyword">super</span>.onAttach(activity);</span><br><span class="line">       </span><br><span class="line">       	<span class="comment">// This makes sure that the container activity has implemented</span></span><br><span class="line">       	<span class="comment">// the callback interface. If not, it throws an exception</span></span><br><span class="line">       	<span class="keyword">try</span> &#123;</span><br><span class="line">           	mCallback = (OnHeadlineSelectedListener) activity;</span><br><span class="line">       	&#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">           	<span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(activity.toString()</span><br><span class="line">                   + <span class="string">" must implement OnHeadlineSelectedListener"</span>);</span><br><span class="line">       	&#125;</span><br><span class="line">   	&#125;</span><br><span class="line">   </span><br><span class="line">   	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line">       implements <span class="type">HeadlinesFragment</span>.<span class="type">OnHeadlineSelectedListener</span>&#123;</span><br><span class="line">   	...</span><br><span class="line">   </span><br><span class="line">   	public void onArticleSelected(int position) &#123;</span><br><span class="line">       	<span class="comment">// The user selected the headline of an article from the HeadlinesFragment</span></span><br><span class="line">       	<span class="comment">// Do something here to display that article</span></span><br><span class="line">   	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="六、Adding-items-to-the-App-Bar-and-Options-Menu"><a href="#六、Adding-items-to-the-App-Bar-and-Options-Menu" class="headerlink" title="六、Adding items to the App Bar( and Options Menu)"></a>六、Adding items to the App Bar( and Options Menu)</h3><p>Still not used.</p>
</div><div class="tags"><a href="/tags/Fragment/">Fragment</a></div><div class="post-nav"><a href="/2015/11/23/android-loaders/" class="pre">Android-Loaders</a><a href="/2015/11/05/android-tasks-and-stack/" class="next">Android-Tasks-And-Stack</a></div><div data-thread-key="2015/11/11/android-fragment/" data-title="Android-Fragment" data-url="http://ccsun.github.io/2015/11/11/android-fragment/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/11/11/android-fragment/" data-title="Android-Fragment" data-url="http://ccsun.github.io/2015/11/11/android-fragment/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Stack/" style="font-size: 15px;">Stack</a> <a href="/tags/Acivity/" style="font-size: 15px;">Acivity</a> <a href="/tags/Memory/" style="font-size: 15px;">Memory</a> <a href="/tags/Building/" style="font-size: 15px;">Building</a> <a href="/tags/Signing/" style="font-size: 15px;">Signing</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Fragment/" style="font-size: 15px;">Fragment</a> <a href="/tags/IconSize/" style="font-size: 15px;">IconSize</a> <a href="/tags/Loaders/" style="font-size: 15px;">Loaders</a> <a href="/tags/Optimization/" style="font-size: 15px;">Optimization</a> <a href="/tags/项目目录/" style="font-size: 15px;">项目目录</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/DeepLink/" style="font-size: 15px;">DeepLink</a> <a href="/tags/AppIndex/" style="font-size: 15px;">AppIndex</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Object-c/" style="font-size: 15px;">Object-c</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/XCode/" style="font-size: 15px;">XCode</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/android-performance-optimization/">Android-Performance-Optimization</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/24/android-overview-screen/">Android-Overview-Screen</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/27/spring/">Spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/object-c-diary/">Object-c Diary</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/xcode-manual/">XCode Manual</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/11/android-displaying-bitmap-efficiently/">Android-Displaying-Bitmap-Efficiently</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/09/java-jvm-memory-management/">JVM-Memory-Management</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/04/android-improving-layout-performance/">Android-Improving-Layout-Performance</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/android-managing-memory/">Android-Managing-Memory</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/23/android-loaders/">Android-Loaders</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">叶枫很疯.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'ccSun7758'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-72788993-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f46a81e8b7f09cf131355bd147357eb9";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>